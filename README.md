# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание проекта
### Интерфейсы и типы данных


#### ILotItem

Интерфейс `ILotItem` представляет собой данные о товаре в магазине. Каждый товар имеет уникальный идентификатор (`id`), название (`title`), описание (`description`), изображение (`image`), цену (`price`) и категорию (`category`).

```typescript
export interface ILotItem {
    id: string;
    title: string;
    description?: string;
    image: string;
    price: number | null;
    category: string;
}
```

#### IBasketItem
Тип `IBasketItem` представляет собой данные о товаре, хранимые в корзине покупок. Он включает только часть информации о товаре: идентификатор (`id`), название (`title`) и цену (`price`)

```typescript
export type IBasketItem = Pick<ILotItem, 'id' | 'title' | 'price'> & {
    isMyBid: boolean
};
```


#### IAppState
Интерфейс `IAppState` описывает состояние приложения. Включает в себя каталог товаров (`catalog`), содержимое корзины (`basket`), превью выбранного товара (`preview`) и информацию о заказе (`order`).

```typescript
export interface IAppState {
    catalog: ILotItem[];
    basket: string[];
    preview: string | null;
    order: IOrder | null;
}
```

#### IOrderForm и IOrder
Интерфейс `IOrderForm` определяет данные о покупателе, такие как электронная почта (`email`) и номер телефона (`phone`).
`IOrder` расширяет `IOrderForm`, добавляя массив идентификаторов товаров (`items`), составляющих заказ.

```typescript
export interface IOrderForm {
    email: string;
    phone: string;
}

export interface IOrder extends IOrderForm {
    items: string[];
}
```

#### FormErrors
Тип `FormErrors` представляет собой частичное соответствие между полями формы заказа и строками с сообщениями об ошибках.

```typescript
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```

#### IOrderResult
Интерфейс `IOrderResult` описывает результат заказа, включая уникальный идентификатор (`id`) полученного заказа.

```typescript
export interface IOrderResult {
    id: string;
}
```
#### ICardAPI
Интерфейс `ICardAPI` представляет собой набор методов для взаимодействия с API приложения. Включает методы для получения списка товаров (`getLotList`), получения информации о конкретном товаре (`getLotItem`) и оформления заказа (`orderLots`).

```typescript
export interface ICardAPI {
    getLotList: () => Promise<ILotItem[]>;
    getLotItem: (id: string) => Promise<ILotItem>;
    orderLots: (order: IOrder) => Promise<IOrderResult>;
}
```
# Реализация
### Базовый код
#### Взаимодействие с сервером

### Класс Api

Для общения с сервером используется класс `Api`, который предоставляет удобный интерфейс для отправки запросов. Он содержит базовый URL сервера и методы для выполнения GET и POST запросов.
### Методы класса Api
* `constructor(baseUrl: string, options?: RequestInit)`: Создает новый экземпляр класса Api с указанным базовым URL и опциями запроса.

* `get(uri: string)`: Выполняет GET запрос по указанному URI и возвращает Promise с результатом запроса в формате JSON.

* `post(uri: string, data: object, method: ApiPostMethods = 'POST')`: Выполняет POST запрос по указанному URI с переданными данными и методом (по умолчанию 'POST'). Возвращает Promise с результатом запроса в формате JSON.

## Абстрактный класс Component `<T>`

Абстрактный класс `Component<T>` предоставляет инструментарий для работы с DOM в дочерних компонентах.

### Методы
1) `toggleClass(element: HTMLElement, className: string, force?: boolean)`: Переключает класс элемента.

2) `setText(element: HTMLElement, value: unknown)`: Устанавливает текстовое содержимое элемента.

3) `setDisabled(element: HTMLElement, state: boolean)`: Устанавливает или убирает атрибут disabled для элемента.

4) `setHidden(element: HTMLElement)`: Скрывает элемент.

5) `setVisible(element: HTMLElement)`: Показывает элемент.

6) `setImage(element: HTMLImageElement, src: string, alt?: string)`: Устанавливает изображение с альтернативным текстом для элемента `<img`>.

7) `render(data?: Partial<T>): HTMLElement`: Возвращает корневой DOM-элемент компонента. Может принимать данные в виде объекта `Partial<T>`, которые будут применены к компоненту.

## Абстрактный класс Model `<T>`

Абстрактный класс `Model<T>` представляет базовую модель данных событийного уведомления.

### Методы
* `emitChanges(event: string, payload?: object)`: Оповещает об изменениях в модели, отправляя событие event с переданным payload.

## Класс EventEmitter

Класс `EventEmitter` реализует интерфейс `IEvents` и предоставляет функциональность для управления событиями.

### Методы
* `on(eventName: EventName, callback: (event: T) => void)`: Устанавливает обработчик для указанного события.

* `off(eventName: EventName, callback: Subscriber)`: Снимает обработчик с указанного события.

* `emit(eventName: string, data?: T)`: Инициирует указанное событие с переданными данными.

* `onAll(callback: (event: EmitterEvent) => void)`: Устанавливает обработчик для всех событий.

* `offAll()`: Удаляет все обработчики событий.

* `trigger(eventName: string, context?: Partial<T>)`: Создает коллбек-триггер, который генерирует указанное событие при вызове.

## Класс AppState

Класс `AppState` расширяет абстрактный класс `Model<IAppState>` и представляет состояние приложения.

### Свойства

- **basket**: Массив элементов корзины товаров.
- **catalog**: Массив элементов каталога товаров.
- **order**: Данные о заказе, включая email, телефон, адрес, способ оплаты и выбранные товары.
- **preview**: ID предпросмотренного товара.
- **formErrors**: Ошибки формы заказа.

### Методы

- **addItemToBasket(item: LotItem)**: Добавляет товар в корзину и вызывает событие `'basketInfo:changed'`.
- **removeItemFromBasket(item: LotItem)**: Удаляет товар из корзины и вызывает событие `'basketInfo:changed'`.
- **count()**: Возвращает количество товаров в корзине.
- **clearBasket()**: Очищает корзину и вызывает событие `'basketInfo:changed'`.
- **getTotal()**: Возвращает общую стоимость товаров в корзине.
- **setCatalog(items: ILotItem[])**: Устанавливает каталог товаров и вызывает событие 'items:changed'.
- **itemExists(item: IBasketItem)**: Проверяет, существует ли указанный товар в корзине.
- **clearFormData()**: Очищает данные о заказе.
- **setPreview(item: LotItem)**: Устанавливает предпросмотренный товар и вызывает событие `'preview:changed'`.
- **confirmBasketItem()**: Подтверждает товары в корзине для заказа.
- **setOrderField(field: keyof IOrderForm, value: string)**: Устанавливает значение поля заказа и проверяет его валидность.
- **paymentField()**: Проверяет валидность поля способа оплаты.
- **setContactField(field: keyof IOrderForm, value: string)**: Устанавливает значение поля контактов и проверяет его валидность.
- **validateOrder()**: Проверяет валидность данных о заказе и вызывает событие `'formErrors:change'` с ошибками.
- **validateContact()**: Проверяет валидность контактных данных и вызывает событие `'formErrors:change'` с ошибками.

Этот класс управляет состоянием приложения, обеспечивая функциональность добавления и удаления товаров из корзины, управления данными заказа и валидацию формы.

## Класс Basket

Класс `Basket` расширяет абстрактный класс `Component<IBasketView>` и представляет корзину покупок на странице.

#### Свойства
- **_list**: HTML-элемент списка товаров в корзине.
- **_total**: HTML-элемент для отображения общей суммы покупки.
- **_button**: HTML-элемент кнопки оформления заказа.

#### Методы
- **items(items: HTMLElement[])**: Устанавливает список элементов товаров в корзине и обновляет отображение.
- **total(total: number)**: Устанавливает общую сумму покупки и отображает ее в соответствующем элементе.

Этот класс обеспечивает управление отображением корзины покупок на странице, обновляя список товаров, отображая общую сумму покупки и активируя кнопку оформления заказа.

## Класс Modal

Класс `Modal` расширяет абстрактный класс `Component<IModalData>` и представляет модальное окно на веб-странице.
Создает новый экземпляр класса Modal с указанным контейнером и объектом событий `IEvents`.

#### Свойства
- **_closeButton**: HTML-элемент кнопки закрытия модального окна.
- **_content**: HTML-элемент содержимого модального окна.

#### Методы
- **content(value: HTMLElement)**: Устанавливает содержимое модального окна.
- **open()**: Открывает модальное окно и генерирует событие `'modal:open'`.
- **close()**: Закрывает модальное окно, очищает содержимое и генерирует событие `'modal:close'`.
- **render(data: IModalData)**: Рендерит модальное окно с указанными данными, открывая его при этом.


#### Обработчики событий
- `_closeButton.addEventListener('click', this.close.bind(this))`: Добавляет обработчик клика на кнопку закрытия модального окна.
- `this.container.addEventListener('click', this.close.bind(this))`: Добавляет обработчик клика на область вне модального окна для закрытия его.
- `_content.addEventListener('click', (event) => event.stopPropagation())`: Предотвращает закрытие модального окна при клике на его содержимое.


Этот класс обеспечивает управление отображением модального окна на странице, позволяя открывать и закрывать его, а также устанавливать содержимое.

## Класс Form

Класс `Form` расширяет абстрактный класс `Component<IFormState>` и представляет форму на веб-странице.
Создает новый экземпляр класса Form с указанным контейнером (HTML-элемент формы) и объектом событий `IEvents`.

#### Свойства
- **_submit**: HTML-элемент кнопки отправки формы.
- **_errors**: HTML-элемент для отображения сообщений об ошибках.

#### Методы
- `onInputChange(field: keyof T, value: string)`: Обрабатывает изменение значения в полях формы и генерирует соответствующее событие.
- `set valid(value: boolean)`: Устанавливает состояние кнопки отправки формы (активна/неактивна).
- `set errors(value: string)`: Устанавливает сообщения об ошибках для отображения в форме.
render(state: Partial<T> & IFormState): Рендерит форму с указанным состоянием, обновляя значения полей и отображая ошибки.

#### Обработчики событий
- `this.container.addEventListener('input', ...)`: Добавляет обработчик изменения значений в полях формы для реакции на пользовательский ввод.
- `this.container.addEventListener('submit', ...)`: Добавляет обработчик отправки формы, который предотвращает стандартное поведение отправки формы и генерирует событие `'форма:submit'`.

Этот класс обеспечивает управление отображением и взаимодействием с формой на странице, позволяя реагировать на ввод пользователей, отображать сообщения об ошибках и управлять состоянием кнопки отправки формы.

## Класс ContactsForm

Класс `ContactsForm` расширяет класс `Form<IOrderForm>` и представляет форму контактной информации на веб-странице.
Создает новый экземпляр класса ContactsForm с указанным контейнером (HTML-элемент формы) и объектом событий `IEvents`, используя конструктор родительского класса `Form`.


#### Свойства
- **phone**: Устанавливает значение телефона в поле формы.
- **email**: Устанавливает значение электронной почты в поле формы.

#### Методы
Этот класс наследует все методы класса Form, поскольку он является его подклассом.

#### Обработчики событий
Этот класс также наследует все обработчики событий класса `Form`, такие как обработчик изменения значения в полях формы и обработчик отправки формы.

Класс **ContactsForm** предоставляет дополнительные возможности для установки значений полей формы контактной информации (телефона и электронной почты) с помощью соответствующих свойств.

## Класс Order

Класс `Order` расширяет класс `Form<IOrderForm>` и представляет форму оформления заказа на веб-странице.
Создает новый экземпляр класса Order с указанным контейнером (HTML-элемент формы) и объектом событий `IEvents`, используя конструктор родительского класса `Form`.

#### Приватное свойство
- **_paymentMethod**: Строка, представляющая выбранный метод оплаты.

#### Методы
Этот класс наследует все методы класса Form, поскольку он является его подклассом.

#### Обработчики событий
Класс `Order` устанавливает обработчики событий для переключения метода оплаты между наличными и онлайн-оплатой.

#### Свойства
- **address**: Устанавливает значение адреса в поле формы.
- **payment**: Устанавливает выбранный метод оплаты в форме.
- **paymentMethod**: Возвращает текущий выбранный метод оплаты.

Класс `Order` предоставляет функциональность для установки адреса доставки и выбора метода оплаты на веб-странице.

## Класс Success

Класс `Success` представляет компонент для отображения сообщения об успешном завершении заказа на веб-странице.

Создает новый экземпляр класса `Succes`s с указанным контейнером (HTML-элемент, содержащий сообщение об успешном завершении заказа), общим количеством синапсов в заказе (`totalAmount`) и объектом действий `ISuccessActions`.

#### Свойства
- **_close**: HTML-элемент для закрытия сообщения об успешном завершении заказа.
- **_totalAmount**: HTML-элемент, отображающий общее количество синапсов в заказе.

#### Обработчики событий
- `onClick`: Обработчик события клика на элементе закрытия сообщения об успешном завершении заказа.

Класс `Success` обеспечивает отображение сообщения об успешном завершении заказа на веб-странице.

## Класс Card<T>

Класс `Card<T>` представляет базовый компонент для отображения карточки элемента. Он обеспечивает основные функции для управления содержимым карточки, такие как установка заголовка, изображения, описания и действия при клике.

Создает новый экземпляр класса `Card<T>` с указанным именем блока (`blockName`), контейнером (HTML-элемент, содержащий карточку) и объектом действий `ICardActions`.


#### Свойства
- **_title**: HTML-элемент для отображения заголовка карточки.
- **_image**: HTML-элемент для отображения изображения карточки.
- **_description**: HTML-элемент для отображения описания карточки.
- **_button**: HTML-элемент кнопки для действий при клике.
- **_category**: HTML-элемент для отображения категории карточки.
- **_price**: HTML-элемент для отображения цены карточки.
- **_index**: HTML-элемент для отображения индекса карточки.

#### Методы
- `setId(value: string)`: Устанавливает идентификатор карточки.
- `getId(): string`: Получает идентификатор карточки.
- `setTitle(value: string)`: Устанавливает заголовок карточки.
- `getTitle(): string`: Получает заголовок карточки.
- `setImage(value: string)`: Устанавливает изображение карточки.
- `setIndex(value: number)`: Устанавливает индекс карточки.
- `setDescription(value: string | string[])`: Устанавливает описание карточки.
- `setButton(text: string)`: Устанавливает текст кнопки (если есть).
- `setCategory(value: string)`: Устанавливает категорию карточки.
- `getCategory(): string`: Получает категорию карточки.
- `setPrice(value: string)`: Устанавливает цену карточки.
- `getPrice(): string`: Получает цену карточки.

### Класс CatalogItem
Класс CatalogItem наследует функциональность класса Card<T> и представляет конкретный тип карточки для элементов каталога. Он дополняет базовый функционал карточки специфическими свойствами и методами, такими как установка категории и цены.

Создает новый экземпляр класса `CatalogItem` с указанным контейнером (HTML-элемент, содержащий карточку) и объектом действий `ICardActions`.

#### Дополнительные свойства и методы
- `setButtonText(text: string)`: Устанавливает текст кнопки карточки.
- `setCategory(value: string)`: Устанавливает категорию карточки и соответствующий класс стиля.
- `getCategory(): string`: Получает категорию карточки.
- `setPrice(value: string)`: Устанавливает цену карточки и отключает кнопку, если цена равна `null`.
- `getPrice(): string`: Получает цену карточки.

## Класс Page

Класс `Page` представляет компонент страницы, который управляет различными элементами интерфейса, такими как счетчик корзины, каталог продуктов и блокировка страницы.

Создает новый экземпляр класса `Page` с указанным контейнером (HTML-элемент, представляющий страницу) и объектом событий `IEvents`.

#### Свойства
- **_counter**: HTML-элемент для отображения счетчика корзины.
- **_catalog**: HTML-элемент для отображения каталога продуктов.
- **_wrapper**: HTML-элемент обертки страницы.
- **_basket**: HTML-элемент корзины.

#### Методы
- **setCounter(value: number)**: Устанавливает значение счетчика корзины.
- **setCatalog(items: HTMLElement[])**: Заменяет содержимое каталога новым списком элементов.
- **setLocked(value: boolean)**: Блокирует или разблокирует страницу в зависимости от значения value. Если value равно true, добавляется класс `page__wrapper_locked`, в противном случае - удаляется.

#### События
- `bucket:open`: Событие, которое возникает при нажатии на корзину, чтобы открыть ее.

## Класс CardAPI

Класс `CardAPI` расширяет класс `Api` и реализует интерфейс `ICardAPI`, предоставляя методы для взаимодействия с API приложения для работы с карточками товаров.

*Создает новый экземпляр класса CardAPI с указанным базовым URL сервера, настройками запроса и URL для контента CDN.*

### Свойства
* `cdn`: строка, представляющая URL для контента CDN.

### Методы
* `getLotItem(id: string): Promise<ILotItem>`: Получает информацию о карточке товара по ее идентификатору.

* `getLotList(): Promise<ILotItem[]>`: Получает список карточек товаров.

* `orderLots(order: IOrder): Promise<IOrderResult>`: Добавляет одну или несколько товаров в корзину и оформляет заказ.


# Presenter
## Обработка событий

### Событие `'items:changed'`

Это событие вызывается при изменении списка товаров. В ответ на это событие происходит обновление каталога на странице, где каждая карточка товара создается с помощью экземпляра класса `CatalogItem`. При клике на карточку товара генерируется событие `'card:select'`, которое передает информацию о выбранном товаре.

### Событие `'card:select'`

Это событие вызывается при выборе карточки товара. В ответ на это событие открывается модальное окно с подробной информацией о товаре. Если товар уже добавлен в корзину, он может быть удален с помощью события `'item.remove'`. В противном случае товар добавляется в корзину с помощью события `'item.add'`.

### События `'item.add'` и `'item.remove'`

Эти события вызываются при добавлении или удалении товара из корзины. При добавлении товара вызывается метод `addItemToBasket()` объекта `appData`, который добавляет товар в корзину. При удалении товара вызывается метод `removeItemFromBasket()` объекта `appData`, который удаляет товар из корзины.

### Прочие события

Существуют также другие события, такие как `'basketInfo:changed'`, `'bucket:open'`, `'order:open'`, `'order:submit'`, `'contacts:submit'`, `'paymentMethod:changed'`, `'formErrors:change'`, `'modal:open'` и `'modal:close'`. Они управляют различными аспектами работы приложения, такими как обновление информации о корзине, открытие модального окна для оформления заказа, управление состоянием формы и блокировка/разблокировка прокрутки страницы при открытии модального окна.